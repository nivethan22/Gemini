name: "âš¡ EnigMano Win11 + 128 Cores Deployment"

on:
  workflow_dispatch:
    inputs:
      INSTANCE:
        description: "Instance number to deploy (e.g., 1, 2, 3...)"
        required: true
        default: "1"

jobs:
  deploy-enigmano:
    name: "ðŸš€ Deploy EnigMano Instance ${{ github.event.inputs.INSTANCE }}"
    runs-on: windows-11-arm

    env:
      INSTANCE_ID: ${{ github.event.inputs.INSTANCE }}
      # WARNING: Hardcoding sensitive values is a security risk.
      CRD_PIN: "YOUR_PIN_HERE" # <<< REPLACE THIS WITH YOUR 6-DIGIT PIN
      CRD_TOKEN: "YOUR_CRD_TOKEN_HERE" # <<< REPLACE THIS WITH YOUR LONG REFRESH TOKEN
      REPO: ${{ github.repository }}
      WORKFLOW_FILE: "enigmano-Win-11-128-Cores.yml"
      DEPLOYMENT_ID: ${{ github.run_id }}

    steps:
      - name: ðŸ“Œ Deployment Parameters
        shell: pwsh
        run: |
          $prevInstance = [int]$env:INSTANCE_ID - 1
          Write-Host "==============================================="
          Write-Host "ðŸ”¹ EnigMano Instance     : $env:INSTANCE_ID"
          Write-Host "ðŸ”¢ Previous Instance     : $prevInstance"
          Write-Host "ðŸ“¦ GitHub Repository     : $env:REPO"
          Write-Host "ðŸ” Deployment Workflow   : $env:WORKFLOW_FILE"
          Write-Host "ðŸ†” Deployment ID         : $env:DEPLOYMENT_ID"
          Write-Host "==============================================="

      - name: ðŸ” Check for Placeholder Values (SECURITY WARNING)
        shell: pwsh
        run: |
          if ($env:CRD_PIN -eq "YOUR_PIN_HERE" -or $env:CRD_TOKEN -eq "YOUR_CRD_TOKEN_HERE") {
            Write-Error "âŒ CRD setup failed: You must replace the placeholder values (YOUR_PIN_HERE, YOUR_CRD_TOKEN_HERE) with your actual PIN and Token, or use GitHub Secrets instead."
            exit 1
          }
          Write-Host "âœ… Using hardcoded CRD values. Proceeding with caution."

      - name: âš™ï¸ Install & Configure Chrome Remote Desktop
        shell: pwsh
        run: |
          $script = @"
          function Get-CrdPinHash([string]`$pin) {
              `$bytes = [System.Text.Encoding]::UTF8.GetBytes(`$pin)
              `$sha256 = [System.Security.Cryptography.SHA256]::Create()
              `$hash = `$sha256.ComputeHash(`$bytes)
              return [System.Convert]::ToBase64String(`$hash)
          }

          Write-Host "ðŸŒ Downloading CRD Host..."
          `$url = "https://dl.google.com/dl/edgedl/chrome-remote-desktop/chromeremotedesktophost.msi"
          `$output = "crd.msi"
          Invoke-WebRequest -Uri `$url -OutFile `$output -UseBasicParsing

          Write
